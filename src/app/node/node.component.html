<!-- initial nodes -->
<div cdkDropList [id]="rootID" [cdkDropListData]="nodes"
     (cdkDropListDropped)="drop($event, dropData)" [cdkDropListSortingDisabled]="true">

  <div cdkDrag *ngFor="let node of nodes" [cdkDragData]="node.id" (cdkDragMoved)="dragMoved($event)">
    <ng-container *ngTemplateOutlet="nodeTemp; context:{node:node}"></ng-container>
  </div>
</div>


<!-- template for all nodes -->
<ng-template #nodeTemp let-node="node">
  <div class="node-item w-100" [attr.data-id]="node.id" [attr.id]="'node-' + node.id">
    <div [attr.id]="node.id + '-Over'" class="drop-line"></div>


    <!-- content of the node -->
    <div class="d-flex flex-row align-items-center" [style.min-height]="'48px'" [style.padding-left]="'5px'">
      <div *ngIf="node.children.length" [style.padding-right]="'5px'">
        <img *ngIf="!node.isExpanded" class="icon-32" src="assets/up-less.png" (click)="node.isExpanded = !node.isExpanded">
        <img *ngIf="node.isExpanded" class="icon-32" src="assets/down-more.png" (click)="node.isExpanded = !node.isExpanded">
      </div>

      <div *ngFor="let content of node.content; let first = first" class="d-flex flex-row align-items-center" [style.min-width]="'180px'" [style.padding-left]="'5px'">
        <span *ngIf="!$any(content).isEditing" [style.padding-bottom]="'3px'" [style.padding-right]="'5px'" (click)="$any(content).isEditing = true">{{$any(content).text}}</span>
        <img *ngIf="!$any(content).isEditing && first" class="icon-24" src="assets/delete.png" (click)="onDeleteNode(node)">

        <app-input *ngIf="$any(content).isEditing" [node]="node" [content]="$any(content)" (onSave)="onSaveContent(node, $event)"></app-input>
      </div>

      <img *ngIf="node.content.length < 5" class="icon-24" src="assets/add.png" (click)="onAddContent(node)">
    </div>



    <!-- row: left is relationship lines and right is node + its children -->
    <div class="d-flex flex-row" *ngIf="node.isExpanded && node.children.length">
      <div [style.margin-top]="'-5px'" [style.margin-bottom]="'15px'"
           [style.padding-left]="'18px'" [style.border-right]="'2px solid'">
      </div>

      <!-- all children nodes -->
      <div cdkDropList class="w-100" [id]="node.id" [cdkDropListData]="node.children"
           (cdkDropListDropped)="drop($event, dropData)" [cdkDropListSortingDisabled]="true">

        <!-- each child node -->
        <div cdkDrag *ngFor="let child of node.children" [cdkDragData]="child.id" (cdkDragMoved)="dragMoved($event)">
          <div class="d-flex flex-row">
            <div style="width: 20px; height: 26px; border-bottom: 2px solid;"></div>

            <ng-container *ngTemplateOutlet="nodeTemp; context:{node:child}"></ng-container>
          </div>
        </div>

        <!-- add buttons at end of branch -->
        <div class="d-flex flex-row" [style.min-height]="'32px'">
          <div style="width: 10px; height: 17px; border-bottom: 2px solid;"></div>
          <img class="icon-24 align-self-center" src="assets/add.png" [style.margin-left]="'5px'" (click)="onAddNode(node)">
        </div>

      </div>
    </div>


    <div [attr.id]="node.id + '-Under'" class="drop-line"></div>
  </div>
</ng-template>
